/*! For license information please see solid-rest-browser.bundle.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SolidRestBrowser=e():t.SolidRestBrowser=e()}(self,(function(){return(()=>{var t={639:function(t,e,r){var n;t=r.nmd(t),function(s){e&&e.nodeType,t&&t.nodeType;var o="object"==typeof r.g&&r.g;o.global!==o&&o.window!==o&&o.self;var i,a=2147483647,h=36,c=/^xn--/,u=/[^\x20-\x7E]/,l=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,d=String.fromCharCode;function m(t){throw RangeError(p[t])}function y(t,e){for(var r=t.length,n=[];r--;)n[r]=e(t[r]);return n}function w(t,e){var r=t.split("@"),n="";return r.length>1&&(n=r[0]+"@",t=r[1]),n+y((t=t.replace(l,".")).split("."),e).join(".")}function g(t){for(var e,r,n=[],s=0,o=t.length;s<o;)(e=t.charCodeAt(s++))>=55296&&e<=56319&&s<o?56320==(64512&(r=t.charCodeAt(s++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),s--):n.push(e);return n}function b(t){return y(t,(function(t){var e="";return t>65535&&(e+=d((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+d(t)})).join("")}function T(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function x(t,e,r){var n=0;for(t=r?f(t/700):t>>1,t+=f(t/e);t>455;n+=h)t=f(t/35);return f(n+36*t/(t+38))}function E(t){var e,r,n,s,o,i,c,u,l,p,d,y=[],w=t.length,g=0,T=128,E=72;for((r=t.lastIndexOf("-"))<0&&(r=0),n=0;n<r;++n)t.charCodeAt(n)>=128&&m("not-basic"),y.push(t.charCodeAt(n));for(s=r>0?r+1:0;s<w;){for(o=g,i=1,c=h;s>=w&&m("invalid-input"),((u=(d=t.charCodeAt(s++))-48<10?d-22:d-65<26?d-65:d-97<26?d-97:h)>=h||u>f((a-g)/i))&&m("overflow"),g+=u*i,!(u<(l=c<=E?1:c>=E+26?26:c-E));c+=h)i>f(a/(p=h-l))&&m("overflow"),i*=p;E=x(g-o,e=y.length+1,0==o),f(g/e)>a-T&&m("overflow"),T+=f(g/e),g%=e,y.splice(g++,0,T)}return b(y)}function v(t){var e,r,n,s,o,i,c,u,l,p,y,w,b,E,v,O=[];for(w=(t=g(t)).length,e=128,r=0,o=72,i=0;i<w;++i)(y=t[i])<128&&O.push(d(y));for(n=s=O.length,s&&O.push("-");n<w;){for(c=a,i=0;i<w;++i)(y=t[i])>=e&&y<c&&(c=y);for(c-e>f((a-r)/(b=n+1))&&m("overflow"),r+=(c-e)*b,e=c,i=0;i<w;++i)if((y=t[i])<e&&++r>a&&m("overflow"),y==e){for(u=r,l=h;!(u<(p=l<=o?1:l>=o+26?26:l-o));l+=h)v=u-p,E=h-p,O.push(d(T(p+v%E,0))),u=f(v/E);O.push(d(T(u,0))),o=x(r,b,n==s),r=0,++n}++r,++e}return O.join("")}i={version:"1.3.2",ucs2:{decode:g,encode:b},decode:E,encode:v,toASCII:function(t){return w(t,(function(t){return u.test(t)?"xn--"+v(t):t}))},toUnicode:function(t){return w(t,(function(t){return c.test(t)?E(t.slice(4).toLowerCase()):t}))}},void 0===(n=function(){return i}.call(e,r,e,t))||(t.exports=n)}()},41:t=>{"use strict";function e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,r,n,s){r=r||"&",n=n||"=";var o={};if("string"!=typeof t||0===t.length)return o;var i=/\+/g;t=t.split(r);var a=1e3;s&&"number"==typeof s.maxKeys&&(a=s.maxKeys);var h=t.length;a>0&&h>a&&(h=a);for(var c=0;c<h;++c){var u,l,p,f,d=t[c].replace(i,"%20"),m=d.indexOf(n);m>=0?(u=d.substr(0,m),l=d.substr(m+1)):(u=d,l=""),p=decodeURIComponent(u),f=decodeURIComponent(l),e(o,p)?Array.isArray(o[p])?o[p].push(f):o[p]=[o[p],f]:o[p]=f}return o}},145:t=>{"use strict";var e=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,r,n,s){return r=r||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map((function(s){var o=encodeURIComponent(e(s))+n;return Array.isArray(t[s])?t[s].map((function(t){return o+encodeURIComponent(e(t))})).join(r):o+encodeURIComponent(e(t[s]))})).join(r):s?encodeURIComponent(e(s))+n+encodeURIComponent(e(t)):""}},486:(t,e,r)=>{"use strict";e.decode=e.parse=r(41),e.encode=e.stringify=r(145)},883:(t,e,r)=>{"use strict";var n=r(639),s=r(225);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.parse=b,e.resolve=function(t,e){return b(t,!1,!0).resolve(e)},e.resolveObject=function(t,e){return t?b(t,!1,!0).resolveObject(e):e},e.format=function(t){return s.isString(t)&&(t=b(t)),t instanceof o?t.format():o.prototype.format.call(t)},e.Url=o;var i=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,h=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(c),l=["%","/","?",";","#"].concat(u),p=["/","?","#"],f=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},y={javascript:!0,"javascript:":!0},w={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=r(486);function b(t,e,r){if(t&&s.isObject(t)&&t instanceof o)return t;var n=new o;return n.parse(t,e,r),n}o.prototype.parse=function(t,e,r){if(!s.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var o=t.indexOf("?"),a=-1!==o&&o<t.indexOf("#")?"?":"#",c=t.split(a);c[0]=c[0].replace(/\\/g,"/");var b=t=c.join(a);if(b=b.trim(),!r&&1===t.split("#").length){var T=h.exec(b);if(T)return this.path=b,this.href=b,this.pathname=T[1],T[2]?(this.search=T[2],this.query=e?g.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var x=i.exec(b);if(x){var E=(x=x[0]).toLowerCase();this.protocol=E,b=b.substr(x.length)}if(r||x||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var v="//"===b.substr(0,2);!v||x&&y[x]||(b=b.substr(2),this.slashes=!0)}if(!y[x]&&(v||x&&!w[x])){for(var O,C,P=-1,A=0;A<p.length;A++)-1!==(R=b.indexOf(p[A]))&&(-1===P||R<P)&&(P=R);for(-1!==(C=-1===P?b.lastIndexOf("@"):b.lastIndexOf("@",P))&&(O=b.slice(0,C),b=b.slice(C+1),this.auth=decodeURIComponent(O)),P=-1,A=0;A<l.length;A++){var R;-1!==(R=b.indexOf(l[A]))&&(-1===P||R<P)&&(P=R)}-1===P&&(P=b.length),this.host=b.slice(0,P),b=b.slice(P),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var S=this.hostname.split(/\./),U=(A=0,S.length);A<U;A++){var _=S[A];if(_&&!_.match(f)){for(var q="",L=0,j=_.length;L<j;L++)_.charCodeAt(L)>127?q+="x":q+=_[L];if(!q.match(f)){var D=S.slice(0,A),F=S.slice(A+1),$=_.match(d);$&&(D.push($[1]),F.unshift($[2])),F.length&&(b="/"+F.join(".")+b),this.hostname=D.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),I||(this.hostname=n.toASCII(this.hostname));var B=this.port?":"+this.port:"",N=this.hostname||"";this.host=N+B,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!m[E])for(A=0,U=u.length;A<U;A++){var k=u[A];if(-1!==b.indexOf(k)){var H=encodeURIComponent(k);H===k&&(H=escape(k)),b=b.split(k).join(H)}}var M=b.indexOf("#");-1!==M&&(this.hash=b.substr(M),b=b.slice(0,M));var G=b.indexOf("?");if(-1!==G?(this.search=b.substr(G),this.query=b.substr(G+1),e&&(this.query=g.parse(this.query)),b=b.slice(0,G)):e&&(this.search="",this.query={}),b&&(this.pathname=b),w[E]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){B=this.pathname||"";var W=this.search||"";this.path=B+W}return this.href=this.format(),this},o.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,i="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&s.isObject(this.query)&&Object.keys(this.query).length&&(i=g.stringify(this.query));var a=this.search||i&&"?"+i||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||w[e])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),e+o+(r=r.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(a=a.replace("#","%23"))+n},o.prototype.resolve=function(t){return this.resolveObject(b(t,!1,!0)).format()},o.prototype.resolveObject=function(t){if(s.isString(t)){var e=new o;e.parse(t,!1,!0),t=e}for(var r=new o,n=Object.keys(this),i=0;i<n.length;i++){var a=n[i];r[a]=this[a]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var h=Object.keys(t),c=0;c<h.length;c++){var u=h[c];"protocol"!==u&&(r[u]=t[u])}return w[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!w[t.protocol]){for(var l=Object.keys(t),p=0;p<l.length;p++){var f=l[p];r[f]=t[f]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||y[t.protocol])r.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),r.pathname=d.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var m=r.pathname||"",g=r.search||"";r.path=m+g}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var b=r.pathname&&"/"===r.pathname.charAt(0),T=t.host||t.pathname&&"/"===t.pathname.charAt(0),x=T||b||r.host&&t.pathname,E=x,v=r.pathname&&r.pathname.split("/")||[],O=(d=t.pathname&&t.pathname.split("/")||[],r.protocol&&!w[r.protocol]);if(O&&(r.hostname="",r.port=null,r.host&&(""===v[0]?v[0]=r.host:v.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),x=x&&(""===d[0]||""===v[0])),T)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,v=d;else if(d.length)v||(v=[]),v.pop(),v=v.concat(d),r.search=t.search,r.query=t.query;else if(!s.isNullOrUndefined(t.search))return O&&(r.hostname=r.host=v.shift(),(I=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=I.shift(),r.host=r.hostname=I.shift())),r.search=t.search,r.query=t.query,s.isNull(r.pathname)&&s.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!v.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var C=v.slice(-1)[0],P=(r.host||t.host||v.length>1)&&("."===C||".."===C)||""===C,A=0,R=v.length;R>=0;R--)"."===(C=v[R])?v.splice(R,1):".."===C?(v.splice(R,1),A++):A&&(v.splice(R,1),A--);if(!x&&!E)for(;A--;A)v.unshift("..");!x||""===v[0]||v[0]&&"/"===v[0].charAt(0)||v.unshift(""),P&&"/"!==v.join("/").substr(-1)&&v.push("");var I,S=""===v[0]||v[0]&&"/"===v[0].charAt(0);return O&&(r.hostname=r.host=S?"":v.length?v.shift():"",(I=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=I.shift(),r.host=r.hostname=I.shift())),(x=x||r.host&&v.length)&&!S&&v.unshift(""),v.length?r.pathname=v.join("/"):(r.pathname=null,r.path=null),s.isNull(r.pathname)&&s.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},o.prototype.parseHost=function(){var t=this.host,e=a.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},225:t=>{"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},33:function(t,e){var r=function(t){function e(){this.fetch=!1,this.DOMException=t.DOMException}return e.prototype=t,new e}("undefined"!=typeof self?self:this);!function(t){!function(e){var r="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,s="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),o="FormData"in t,i="ArrayBuffer"in t;if(i)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(t){return t&&a.indexOf(Object.prototype.toString.call(t))>-1};function c(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function u(t){return"string"!=typeof t&&(t=String(t)),t}function l(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function p(t){this.map={},t instanceof p?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function f(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function d(t){return new Promise((function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}}))}function m(t){var e=new FileReader,r=d(e);return e.readAsArrayBuffer(t),r}function y(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function w(){return this.bodyUsed=!1,this._initBody=function(t){var e;this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:s&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:o&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:r&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():i&&s&&(e=t)&&DataView.prototype.isPrototypeOf(e)?(this._bodyArrayBuffer=y(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):i&&(ArrayBuffer.prototype.isPrototypeOf(t)||h(t))?this._bodyArrayBuffer=y(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},s&&(this.blob=function(){var t=f(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?f(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(m)}),this.text=function(){var t,e,r,n=f(this);if(n)return n;if(this._bodyBlob)return t=this._bodyBlob,r=d(e=new FileReader),e.readAsText(t),r;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),r=new Array(e.length),n=0;n<e.length;n++)r[n]=String.fromCharCode(e[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(T)}),this.json=function(){return this.text().then(JSON.parse)},this}p.prototype.append=function(t,e){t=c(t),e=u(e);var r=this.map[t];this.map[t]=r?r+", "+e:e},p.prototype.delete=function(t){delete this.map[c(t)]},p.prototype.get=function(t){return t=c(t),this.has(t)?this.map[t]:null},p.prototype.has=function(t){return this.map.hasOwnProperty(c(t))},p.prototype.set=function(t,e){this.map[c(t)]=u(e)},p.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},p.prototype.keys=function(){var t=[];return this.forEach((function(e,r){t.push(r)})),l(t)},p.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),l(t)},p.prototype.entries=function(){var t=[];return this.forEach((function(e,r){t.push([r,e])})),l(t)},n&&(p.prototype[Symbol.iterator]=p.prototype.entries);var g=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function b(t,e){var r,n,s=(e=e||{}).body;if(t instanceof b){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new p(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,s||null==t._bodyInit||(s=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new p(e.headers)),this.method=(n=(r=e.method||this.method||"GET").toUpperCase(),g.indexOf(n)>-1?n:r),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&s)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(s)}function T(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var r=t.split("="),n=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(s))}})),e}function x(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new p(e.headers),this.url=e.url||"",this._initBody(t)}b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},w.call(b.prototype),w.call(x.prototype),x.prototype.clone=function(){return new x(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},x.error=function(){var t=new x(null,{status:0,statusText:""});return t.type="error",t};var E=[301,302,303,307,308];x.redirect=function(t,e){if(-1===E.indexOf(e))throw new RangeError("Invalid status code");return new x(null,{status:e,headers:{location:t}})},e.DOMException=t.DOMException;try{new e.DOMException}catch(t){e.DOMException=function(t,e){this.message=t,this.name=e;var r=Error(t);this.stack=r.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function v(t,r){return new Promise((function(n,o){var i=new b(t,r);if(i.signal&&i.signal.aborted)return o(new e.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function h(){a.abort()}a.onload=function(){var t,e,r={status:a.status,statusText:a.statusText,headers:(t=a.getAllResponseHeaders()||"",e=new p,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var r=t.split(":"),n=r.shift().trim();if(n){var s=r.join(":").trim();e.append(n,s)}})),e)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var s="response"in a?a.response:a.responseText;n(new x(s,r))},a.onerror=function(){o(new TypeError("Network request failed"))},a.ontimeout=function(){o(new TypeError("Network request failed"))},a.onabort=function(){o(new e.DOMException("Aborted","AbortError"))},a.open(i.method,i.url,!0),"include"===i.credentials?a.withCredentials=!0:"omit"===i.credentials&&(a.withCredentials=!1),"responseType"in a&&s&&(a.responseType="blob"),i.headers.forEach((function(t,e){a.setRequestHeader(e,t)})),i.signal&&(i.signal.addEventListener("abort",h),a.onreadystatechange=function(){4===a.readyState&&i.signal.removeEventListener("abort",h)}),a.send(void 0===i._bodyInit?null:i._bodyInit)}))}v.polyfill=!0,t.fetch||(t.fetch=v,t.Headers=p,t.Request=b,t.Response=x),e.Headers=p,e.Request=b,e.Response=x,e.fetch=v}({})}(r),delete r.fetch.polyfill,(e=r.fetch).default=r.fetch,e.fetch=r.fetch,e.Headers=r.Headers,e.Request=r.Request,e.Response=r.Response,t.exports=e}},e={};function r(n){var s=e[n];if(void 0!==s)return s.exports;var o=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var n={};return(()=>{"use strict";r.d(n,{default:()=>N});var t=r(883);function e(e,r){const n=s(r);var i;if(n.headers=s(n.headers),n.method=(i=n.method)?i.toUpperCase():"GET",n.slug=n.headers.slug||n.slug||"",n.body=n.body||"",o(e)){n.url=e;const r=new t.Url(e);n.protocol=r.protocol}else n.url=null,n.malFormedUrl=!0;return n.url&&n.url.endsWith(".dummy")&&(n.headers["content-type"]="text/turtle",n.body=""),n}function s(t){let e={};for(var r in t)"host"===r?e.hostname=t[r]:e[r.toLowerCase()]=t[r];return e}const o=e=>{try{return new t.Url(e),!0}catch(t){return!1}};var i;async function a(e,r){let n,s;i=await this.perform("GET_PATH_HANDLER",e),e.startsWith("file")?(n=t.format(r.url),s=t.fileURLToPath(n)):(n=decodeURIComponent(e),s=t.parse(n).pathname);const o=await this.perform("GET_ITEM_INFO",s,r);if(o.mode=o.mode?o.mode:{read:!0,append:!0,write:!0},o.pathname=s,"DELETE"===r.method&&o.isContainer){let t=await this.perform("GET_FILES",o.pathname);t.filter?o.containedFiles=t.length:o.containedFiles=0}return this.getExtension=t=>("object"==typeof(t=t||this.item.pathname||"")&&(t=t.path),!t.startsWith(".")||(t.match(/\./g)||[]).length>1?i.extname(t):t),this.pathSep=i.sep,this.basename=i.extname,this.mungePath=(t,e,r)=>((t=i.join(t,e)).includes("\\")&&(t=t.replace(/\\/g,"/")),t),s="POST"===r.method?this.mungePath(o.pathname,r.slug):o.pathname,o.extension=this.getExtension(s),o.contentType=await this.getContentType(o.pathname),o.patchOnNonTurtle="PATCH"===r.method&&!o.contentType.match("text/turtle"),o.isAcl=s.match(/\.acl/),o.isAuxResource=!!s.match(/\.(acl|meta)$/),o}const h={DELETE:{mustExist:1,requiresWrite:1},POST:{requiresAppend:1,requiresContentType:1},GET:{mustExist:1,requiresRead:1},HEAD:{mustExist:1,requiresRead:1},OPTIONS:{requiresRead:1},PUT:{requiresWrite:1,requiresContentType:1},PATCH:{requiresWrite:1,requiresContentType:1},LOGIN:{}};async function c(t,e){const r=this.requestObj=await this.getRequest(t,e),n=this.item=await this.getItem(t,r);if(!r.url||!r.method)return 400;if(r.slug.endsWith("/"))return 400;if(r.originMismatch)return 403;if(r.unsupportedAcceptFormat)return 405;if("PATCH"===r.method&&!this.patch)return 405;if("POST"===r.method&&!r.headers.link)return 400;if(n.isContainer&&!n.contentType&&(n.contentType="text/turtle"),n.folderFileConfusion)return 400;if(n.patchOnNonRdf)return 400;if(n.isAuxResource&&(n.isAcl&&(r.method.requiresControl=!0),"POST"===r.method))return 403;n.mode.write&&(n.mode.append=!0);const s=h[r.method];if(s||console.log(55,r.method),!s)return 409;if(s.mustExist&&!n.exists)return 404;if(s.requiresRead&&!n.mode.read||s.requiresAppend&&!n.mode.append||s.requiresWrite&&!n.mode.write||s.requiresControl&&!n.mode.control)return 401;if(s.requiresContentType&&!r.headers["content-type"])return 400;if(!("POST"===r.method&&(this.item.pathname=await this.generateRandomSlug(this.item.pathname,r.slug)),"PUT"!==r.method&&"POST"!==r.method&&"PATCH"!==r.method||await this.perform("CREATE_INTERMEDIATE_CONTAINERS")))return 500;let o=await this.perform(r.method);return!o&&"DELETE"===r.method&&n.isContainer&&await this.perform("ITEM_EXISTS",this.item.pathname)?409:o}async function u(t,e,r,n){let s;switch(this.request=this.requestObj,t=t||this.request.method,this.item=this.item||{pathname:e},e=e||this.item.pathname,this.response=this.response||{headers:{}},t){case"STORAGE_NAME":return this.storage.name;case"ITEM_EXISTS":return e=e.replace("file://",""),await this.storage.itemExists(e);case"LOGIN":return await this.storage.login(this.request.loginoptions);case"ITEM_TYPE":return await this.storage.itemType(e);case"GET_CONTENT_TYPE":return await this.storage.getContentType(e).bind(this.storage);case"GET_PATH_HANDLER":return await this.storage.getPathHandler(e);case"GET_ITEM_INFO":return await this.storage.getItemInfo(e,this.request);case"GET_FILES":return await this.storage.getContainer(e);case"DELETE":return this.item.isContainer?(await this.perform("DELETE_AUX_RESOURCES",e),await this.storage.deleteContainer(e)):(await this.perform("DELETE_AUX_RESOURCES",e),await this.storage.deleteResource(e));case"DELETE_AUX_RESOURCES":const t=await this.getAuxResources(e)||[];try{return t.map((async t=>{s=await this.storage.deleteResource(t)})),!0}catch(t){return console.log(t),!1}return 200;case"CREATE_INTERMEDIATE_CONTAINERS":return await this.storage.makeContainers(e)||1;case"GET":if(this.item.isContainer){let t=await this.storage.getContainer(e);return t.headers?t:await this.containerAsTurtle(e,t,this.request.typewanted,this)}{let t=await this.storage.getResource(e);return!!t&&(t.headers?t:(this.response.body=t,this.response.headers.status=200,!0))}case"OPTIONS":case"HEAD":return!0;case"PUT":return r=r||this.request.body,n=n||this.item.contentType||"",await this.storage.putResource(e,r,n);case"FULL_PUT":return!!await this.storage.makeContainers(e)&&(void 0===r&&(r=this.request.body),n=n||this.item.contentType||"",await this.storage.putResource(e,r,n));case"POST":return this.request.headers.link.match("Container")?(this.response.headers.location=e+"/",await this.storage.postContainer(e,this.request)):(this.response.headers.location=e,await this.storage.putResource(e,this.request.body));case"PATCH":const o=this.item.contentType;if(!o.match(/(text\/turtle|text\/n3|application\/ld\+json|application\/rdf\+xml)/))return{status:409,body:"can not patch a file of type "+o};if(e.endsWith("/"))return{status:409,body:"can not patch a Container"};await this.storage.itemExists(e.replace("file://",""))||await this.perform("FULL_PUT",e,"",n);let i,a,h=await this.storage.getResource(e);h=h&&h.body?h.body:h,h="string"==typeof h?h:h.toString();try{if([a,i]=await this.patch.patchContent(h,o,this.request),200!==a)return{status:a,body:i}}catch(t){return t.length||(t=""),{status:t,statusText:t.toString()}}let c=await this.storage.putResource(e,i);return c=c&&c.body?c.body:c,c}}var l=r(33),p="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),f=new Uint8Array(16);function d(){if(!p)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return p(f)}const m=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,y=function(t){return"string"==typeof t&&m.test(t)};for(var w=[],g=0;g<256;++g)w.push((g+256).toString(16).substr(1));const b=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(w[t[e+0]]+w[t[e+1]]+w[t[e+2]]+w[t[e+3]]+"-"+w[t[e+4]]+w[t[e+5]]+"-"+w[t[e+6]]+w[t[e+7]]+"-"+w[t[e+8]]+w[t[e+9]]+"-"+w[t[e+10]]+w[t[e+11]]+w[t[e+12]]+w[t[e+13]]+w[t[e+14]]+w[t[e+15]]).toLowerCase();if(!y(r))throw TypeError("Stringified UUID is invalid");return r},T={200:"OK",201:"Created",400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",408:"Request Timeout",415:"Unsupported Media Type",418:"I'm a teapot",420:"Smoke 'em if you got 'em",500:"Server error"};async function x(t,e){let r=!0,n=e.method||this.request.method||"GET",s={body:"",headers:{}};if("number"==typeof t)r=!1,s.headers.status=t;else if("boolean"==typeof t){let e=t?201:500;e=201===e&&n.match(/(GET|HEAD)/)?200:201,n.match(/OPTIONS/)&&(e=204),s.headers.status=e}else"string"==typeof t?(s.headers.status=200,s.body=t):"object"==typeof t&&(r=!1,s=t,s.headers=s.headers||{},s.headers.status=s.status,s.headers.statusText=s.statusText);n.match(/(PUT)/)&&200==s.headers.status&&(s.headers.status=201),n.match(/(DELETE|GET|HEAD)/)&&201==s.headers.status&&(s.headers.status=200);let o={};this.requestObj;const i=this.item,a=i.pathname;var h,c;a.replace(/.*\//,""),o["content-type"]=this.item.contentType,o.link=o.link||function(t){let e=t.isContainer,r=t.pathname.replace(/\/$/,"");r=r.replace(/.*\//,"");let n=t.extension;return".acl"===n?'<http://www.w3.org/ns/ldp#Resource>; rel="type"':".meta"===n?`<${r}.acl>; rel="acl",<http://www.w3.org/ns/ldp#Resource>; rel="type"`:e?'<.meta>; rel="describedBy", <.acl>; rel="acl",<http://www.w3.org/ns/ldp#Container>; rel="type",<http://www.w3.org/ns/ldp#BasicContainer>; rel="type"<http://www.w3.org/ns/ldp#Resource>; rel="type"':`<${r}.meta>; rel="describedBy", <${r}.acl>; rel="acl",<http://www.w3.org/ns/ldp#Resource>; rel="type"`}(i),o.allow=(h=this.patch,"OPTIONS,HEAD"+((c=this.item.mode).read?",GET":"")+(c.write?",POST,PUT,DELETE":"")+(c.write&&h?",PATCH":"")),o["wac-allow"]=function(t){return t.read||t.write?t.read&&!t.write?'user="read",public="read"':!t.read&&t.write?'user="append write control",public=""':'user="read write append control",public="read"':null}(this.item.mode),o.date=o.date||new Date(Date.now()).toISOString(),o["x-powered-by"]=o["x-powered-by"]||await this.perform("STORAGE_NAME"),this.response&&this.response.headers&&(o.location=this.response.headers.location),o.url=a,"POST"===n&&(o.url=this.request.url),this.patch&&(o["accept-patch"]=["application/sparql-update"],o["ms-author-via"]=["SPARQL"]);let u=s.body||this.response.body||"";Object.assign(o,s.headers),o.status=s.headers.status||this.response.headers.status||500;let p,f=this.request.headers.accept;for(var m of(f=f&&f.match(/ /)?null:f,f&&(f.match(/(text\/turtle|application\/ld\+json)/)?u=await async function(t,e,r,n){return new Promise((async(s,o)=>{let i=$rdf.sym(t),a=$rdf.graph();await $rdf.parse(e,a,t,r),$rdf.serialize(i,a,t,n,((t,e)=>t?o(t):s(e)))}))}(this.request.url,u.toString(),this.item.contentType,f):(o.status="405",o.statusText=`Unsupported content-type in accept header : ${f}`)),o.statusText=o.statusText||T[o.status],o.etag=`W/"${function(t,e,r){var n=(t=t||{}).random||(t.rng||d)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){r=r||0;for(var s=0;s<16;++s)e[r+s]=n[s];return e}return b(n)}()}"`,o["content-length"]="undefined"!=typeof Buffer?Buffer.byteLength(u,"utf8"):"undefined"!=typeof Blob?new Blob([u]).size:77,Object.keys(o)))o[m]||delete o[m];if(o.url.match(/:/)||(o.url=(this.prefix||"file:")+"//"+o.url),"HEAD"===e.method){u="";for(let t of Object.keys(o))u+=`${t}:${o[t]}\n`}if(e.plainResponse)return{status:o.status,statusText:o.statusText,body:u,headers:o,url:o.url,location:o.location};r=!0,o=r?{status:o.status,statusText:o.statusText,headers:o,location:o.location,url:o.url}:o;try{p=new l.Response(u,o,{url:o.url})}catch(t){console.log("Error "+t)}return p}var E,v,O=0,C=0;const P=function(t,e,r){var n=e&&r||0,s=e||new Array(16),o=(t=t||{}).node||E,i=void 0!==t.clockseq?t.clockseq:v;if(null==o||null==i){var a=t.random||(t.rng||d)();null==o&&(o=E=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==i&&(i=v=16383&(a[6]<<8|a[7]))}var h=void 0!==t.msecs?t.msecs:Date.now(),c=void 0!==t.nsecs?t.nsecs:C+1,u=h-O+(c-C)/1e4;if(u<0&&void 0===t.clockseq&&(i=i+1&16383),(u<0||h>O)&&void 0===t.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");O=h,C=c,v=i;var l=(1e4*(268435455&(h+=122192928e5))+c)%4294967296;s[n++]=l>>>24&255,s[n++]=l>>>16&255,s[n++]=l>>>8&255,s[n++]=255&l;var p=h/4294967296*1e4&268435455;s[n++]=p>>>8&255,s[n++]=255&p,s[n++]=p>>>24&15|16,s[n++]=p>>>16&255,s[n++]=i>>>8|128,s[n++]=255&i;for(var f=0;f<6;++f)s[n+f]=o[f];return e||b(s)},A=[".acl",".meta"],R=A.concat(".meta.acl");async function I(t){console.log(`Creating pod at <${t}>`),t=(t=t.replace(/\/$/,"")).replace(/^[^:]*:\/\//,""),await this.perform("FULL_PUT",t+"/.acl","@prefix acl: <http://www.w3.org/ns/auth/acl#>.\n@prefix foaf: <http://xmlns.com/foaf/0.1/>.\n\n# The homepage is readable by the public\n<#public>\n    a acl:Authorization;\n    acl:agentClass foaf:Agent;\n    acl:accessTo <./>;\n    acl:mode acl:Read.\n\n# The owner has full access to every resource in their pod.\n# Other agents have no access rights,\n# unless specifically authorized in other .acl resources.\n<#owner>\n    a acl:Authorization;\n    acl:agent <./profile/card#me>;\n    # Set the access to the root storage folder itself\n    acl:accessTo <./>;\n    # All resources will inherit this authorization, by default\n    acl:default <./>;\n    # The owner has all of the access modes allowed\n    acl:mode\n        acl:Read, acl:Write, acl:Control.\n"),await this.perform("FULL_PUT",t+"/profile/card",'@prefix : <#>.\n@prefix jef: <../>.\n@prefix ldp: <http://www.w3.org/ns/ldp#>.\n@prefix inbox: <../inbox/>.\n@prefix pro: <./>.\n@prefix ter: <http://www.w3.org/ns/solid/terms#>.\n@prefix foaf: <http://xmlns.com/foaf/0.1/>.\n@prefix pim: <http://www.w3.org/ns/pim/space#>.\n@prefix n2: <http://>.\n@prefix n3: <https://>.\n@prefix vcard: <http://www.w3.org/2006/vcard/ns#>.\n@prefix sch: <http://schema.org/>.\n@prefix n1: <http://www.w3.org/ns/auth/acl#>.\n\npro:card a foaf:PersonalProfileDocument; foaf:maker :me; foaf:primaryTopic :me.\n\n:me\n    a sch:Person, foaf:Person;\n    vcard:fn "Local Solid User";\n    vcard:role "software developer";\n    n1:trustedApp\n            [\n                n1:mode n1:Append, n1:Control, n1:Read, n1:Write;\n                n1:origin <http://example.org>\n            ];\n    ldp:inbox inbox:;\n    pim:preferencesFile <../settings/prefs.ttl>;\n    pim:storage jef:;\n    ter:account jef:;\n    ter:privateTypeIndex <../settings/privateTypeIndex.ttl>;\n    ter:publicTypeIndex <../settings/publicTypeIndex.ttl>;\n    foaf:name "Local Solid User".\n'),await this.perform("FULL_PUT",t+"/settings/prefs.ttl",'@prefix : <#>.\n@prefix solid: <http://www.w3.org/ns/solid/terms#>.\n@prefix sp: <http://www.w3.org/ns/pim/space#>.\n@prefix dct: <http://purl.org/dc/terms/>.\n@prefix c: <../profile/card#>.\n@prefix mee: <http://www.w3.org/ns/pim/meeting#>.\n\n<> a sp:ConfigurationFile; dct:title "Preferences file".\n\nc:me\n    a solid:Developer, solid:PowerUser;\n    solid:privateTypeIndex <privateTypeIndex.ttl>;\n    solid:publicTypeIndex <publicTypeIndex.ttl>.\n'),await this.perform("FULL_PUT",t+"/settings/privateTypeIndex.ttl","\n@prefix solid: <https://www.w3.org/ns/solid/terms#>.\n<>\n    a solid:TypeIndex ;\n    a solid:UnlistedDocument.\n"),await this.perform("FULL_PUT",t+"/settings/publicTypeIndex.ttl","@prefix : <#>.\n@prefix solid: <https://www.w3.org/ns/solid/terms#>.\n@prefix terms: <http://purl.org/dc/terms/>.\n@prefix ter: <http://www.w3.org/ns/solid/terms#>.\n@prefix bookm: <http://www.w3.org/2002/01/bookmark#>.\n\n<> a solid:ListedDocument, solid:TypeIndex; terms:references :Bookmark.\n\n:Bookmark\n    a ter:TypeRegistration;\n    ter:forClass bookm:Bookmark;\n    ter:instance <../bookmarks.ttl>.\n"),await this.perform("FULL_PUT",t+"/private/.meta",""),await this.perform("FULL_PUT",t+"/.well-known/.meta",""),await this.perform("FULL_PUT",t+"/public/.meta",""),await this.perform("FULL_PUT",t+"/inbox/.meta","")}function S(t){return A.find((e=>this.getExtension(t)===e))}async function U(t){return t.endsWith(".acl")||t.endsWith(".meta")?[]:R.filter((async e=>await this.perform("ITEM_EXISTS",t+e))).map((e=>t+e))||[]}async function _(t,e=P()){let r=this.mungePath(t,e);return this.item.isContainer&&!this.request.url.endsWith(this.pathSep)&&(r+=this.pathSep),await this.perform("ITEM_EXISTS",r)&&(e=`${P()}-${e}`),this.mungePath(t,e)}async function q(t,e,r,n){const s=n.pathSep;let o=e.filter((t=>{if(t.path&&!t.path.endsWith(".acl")&&!t.path.endsWith(".meta"))return t}));t.endsWith(s)||(t+=s);let i="",a="\n@prefix : <#>.\n@prefix ldp: <http://www.w3.org/ns/ldp#>.\n@prefix dct: <http://purl.org/dc/terms/>.\n@prefix stat: <http://www.w3.org/ns/posix/stat#>.\n@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.\n<> a ldp:BasicContainer, ldp:Container\n";if(o.length){a+="; ldp:contains\n";for(var h=0;h<o.length;h++){let e=o[h].path;r&&(e="/"+r+e),e=encodeURI(e),e=(c=e).substr(c.lastIndexOf(n.pathSep)+1),o[h].isContainer&&!e.endsWith("/")&&(e+="/"),a+=`  <${e}>,\n`;let s,u,l,p,f=o[h].isContainer?"Container":"Resource";if(n&&n.storage.getMetadata)try{let r=await n.storage.getMetadata(t+"/"+e);s=r.contentType,u=r.size,l=r.mtime,p=r.modified}catch(t){console.log(t)}s=s||await n.getContentType(e,f)||"",s=s.replace(/;.*/,""),f=o[h].isContainer?"ldp:Container; a ldp:BasicContainer; a ldp:Resource":"ldp:Resource",i+=`<${e}> a ${f}.\n`,s&&(i+=`<${e}> a <http://www.w3.org/ns/iana/media-types/${s}#Resource>.\n`),u&&(i+=`<${e}> stat:size ${u}; stat:mtime ${l}; dct:"${p}"^^xsd:dateTime.\n`)}a=a.replace(/,\n$/,"")}var c;return a=a+".\n"+i,a}let L;const j="PREFIX solid: <http://www.w3.org/ns/solid/terms#>\n",D={"application/sparql-update":async function(t,e,r){const n=e.replace(/#.*/,"");try{return L.sparqlUpdateParser(r,L.graph(),n)}catch(t){throw new Error(`400 : Patch document syntax error: ${t}`)}},"text/n3":async function(t,e,r){const n=L.graph();try{L.parse(r,n,e,"text/n3")}catch(t){throw new Error(`400 : Patch document syntax error: ${t}`)}let s;try{s=await $(n,`${j}\n      SELECT ?insert ?delete ?where WHERE {\n        ?patch a solid:InsertDeletePatch.\n        OPTIONAL { ?patch solid:inserts ?insert. }\n        OPTIONAL { ?patch solid:deletes ?delete. }\n        OPTIONAL { ?patch solid:where   ?where.  }\n      }`)}catch(e){try{s=await $(n,`${j}\n        SELECT ?insert ?delete ?where WHERE {\n          ?patch solid:patches <${t}>.\n          OPTIONAL { ?patch solid:inserts ?insert. }\n          OPTIONAL { ?patch solid:deletes ?delete. }\n          OPTIONAL { ?patch solid:where   ?where.  }\n        }`)}catch(e){throw new Error(`400 : No patch for ${t} found. ${e}`)}}const{"?insert":o,"?delete":i,"?where":a}=s;return o||i?{insert:o,delete:i,where:a}:[400,"Patch should at least contain inserts or deletes."]}};class F{constructor(t){L=t}async patchContent(t,e,r){const n=r.url,s={contentType:e,url:n},o={text:r.body.toString(),contentType:r.headers["content-type"]},i=D[o.contentType];if(!i)return[415,`415 Unsupported patch content type: ${o.contentType}`];const a=`${n}#patch`;try{const e=await i(n,a,o.text),r=await this.readGraph(t,s);let h=o.text.match(/INSERT/g);return h&&h.length>1?[400,"can not have multiple INSERT statements in a patch"]:(await this.applyPatch(e,r,n),[200,await this.writeGraph(r,s)])}catch(t){return[parseInt(t.message),t.message]}}async readGraph(t,e){const r=L.graph();if(!t.length)return r;try{L.parse(t,r,e.url,e.contentType)}catch(t){throw new Error(`500 : Patch: Target ${e.contentType} file syntax error: ${t}`)}return r}async applyPatch(t,e,r){return new Promise(((n,s)=>e.applyPatch(t,e.sym(r),(t=>{if(t){const e=t.message||t;return s(new Error(`409 : The patch could not be applied. ${e}`))}n(e)}))))}async writeGraph(t,e){const r=t.sym(e.url);console.log(44,e.contentType);try{return L.serialize(r,t,e.url,e.contentType)}catch(t){console.log(t)}}hash(t){return crypto.createHash("md5").update(t).digest("hex")}}function $(t,e){return new Promise(((r,n)=>{const s=L.SPARQLToQuery(e,!1,t);t.query(s,r,null,(()=>["409 : No results."]))}))}class B{constructor(t){(t=t||{}).plugin||(console.log("You must specify a plugin storage handler!"),process.exit(1)),this.storage=t.plugin,this.handleRequest=c.bind(this),this.handleResponse=x.bind(this),this.getItem=a.bind(this),this.getRequest=e.bind(this),this.perform=u.bind(this),this.isAuxResource=S.bind(this),this.getAuxResources=U.bind(this),this.getContentType=this.storage.getContentType.bind(this.storage),this.generateRandomSlug=_.bind(this),this.createServerlessPod=I.bind(this),this.storage.configFetcher&&(this.configFetcher=this.storage.configFetcher.bind(this.storage)),this.storage.configure&&(this.configure=this.storage.configure.bind(this.storage)),this.containerAsTurtle=q.bind(this);let n=t.parser?t.parser:"undefined"!=typeof window&&window.$rdf?window.$rdf:void 0!==r.g&&r.g.$rdf?r.g.$rdf:null;this.patch=t.patch=n?new F(n):null}async fetch(t,e={}){let r=await this.handleRequest(t,e);return await this.handleResponse(r,e)}async login(t){t={loginOptions:t,method:"login"};let e=await this.handleRequest("http://example.org/",t);return await this.handleResponse(e,t)}async itemExists(t){return await this.perform("ITEM_EXISTS",t)}isPatchConflictError(t){if(400===t)return!0}isAccessError(t){if(401===t)return!0}async GET(t){return await this.fetch(t,{method:"GET"})}async HEAD(t){return await this.fetch(t,{method:"HEAD"})}async EXISTS(t){try{return 200==(await this.fetch(t,{method:"HEAD"})).status}catch(t){return!1}}async PUT(t,e,r){return r=r||"text/turtle",await this.fetch(t,{method:"PUT",body:e,headers:{"content-type":r}})}async PATCH(t,e,r){return r=e||"text/n3",await this.fetch(t,{method:"PATCH",body:e,headers:{"Content-Type":r,link:'<http://www.w3.org/ns/ldp#Resource>; rel="type"'},relative:!0})}async DELETE(t){return await this.fetch(t,{method:"DELETE"})}async POST(t,e,r,n){return await this.fetch(t,{method:"POST",headers:{slug:e,link:n,"content-type":"text/turtle"},body:r})}async postFile(t,e,r){return POST(t,e,r,'<http://www.w3.org/ns/ldp#Resource>; rel="type"')}async postFolder(t,e){return POST(t,e,"",'<http://www.w3.org/ns/ldp#BasicContainer>; rel="type"')}}class N{constructor(t){return t||={},this.DEBUG=t.DEBUG||!1,this.prefix="browser",this.name="solid-rest-browser-2.0.0",this.ext=".priv",this.currentItem={},new B({plugin:this})}getPathHandler(t){return{sep:"/",join:(t,e)=>t.replace(/\/$/,"")+"/"+second.replace(/^\//,""),extname:t=>t.substr(t.lastIndexOf(".")+1),basename:t=>t.substr(t.lastIndexOf("/")+1)}}async configure(t){t||={fs:"MountableFileSystem",options:{"/LocalStorage":{fs:"LocalStorage",options:{}},"/HTML5FS":{fs:"HTML5FS",options:{size:1e4}},"/IndexedDB":{fs:"IndexedDB",options:{storeName:"IndexedDB"}}}};const e=this;return new Promise(((r,n)=>{BrowserFS.configure(t,(async function(t,s){return t?n(t):(e.fs=BrowserFS.BFSRequire("fs"),r())}))}))}async hybridFetch(t){t||={};const e={browser:this,http:t.fetch};return(t,r)=>{const n=t.replace(/:\/.*/,"").replace(/s$/,"");return e[n].fetch(t,r)}}async configFetcher(t,e){if(e||={},await this.configure(e.browserFSconfig),e.httpOnly)return $rdf.fetcher(t,e);const r={browser:this,http:e.fetch};return e.fetch=(t,e)=>{const n=t.replace(/:\/.*/,"").replace(/s$/,"");return r[n].fetch(t,e)},$rdf.fetcher(t,e)}async makeContainers(t){const e=t.endsWith("/");let r=[],n=this._getParent(t);for(;n&&!await this.exists(n);)r.push(n),n=this._getParent(n);for(n||Promise.resolve(!0),e&&r.push(t);r.length;){let t=r.pop().slice(0,-1);this.log("Creating container ",t);try{await this.createContainer(t)}catch(t){return console.warn(t),Promise.resolve(!0)}}return Promise.resolve(!0)}async createContainer(t){return await this.fs.mkdir(t),await this.putMetadata(t+"/")}_getParent(t){for("object"==typeof t&&(t=t.href);t.endsWith("/");)t=t.slice(0,-1);return t.includes("/")?t.substring(0,t.lastIndexOf("/"))+"/":null}async getContentType(t,e){if("Container"===e||t.match(/\.(ttl|acl|meta)$/)||t.endsWith("/"))return"text/turtle";try{let e=await this.getResource(t+this.ext);return JSON.parse(e).contentType}catch(t){return console.log(t),null}}async itemType(t){return(await this.fs.statSync(t)).isDirectory()?"Container":"Resource"}async exists(t){return await this.fs.existsSync(t)}async itemExists(t){return await this.fs.existsSync(t)}async getItem(){return this.currentItem}async getItemInfo(t,e){e.method.match(/(PUT|POST|PATCH)/)&&await this.makeContainers(t);let r=await this.exists(t),n=r?await this.itemType(t):null;n||=t.endsWith("/")?"Container":"Resource";let s=r?await this.getContentType(t,n):e.headers["content-type"];return this.currentItem={fileName:t,path:t,extension:"",mode:{read:!0,write:!0,append:!0,control:!0},exists:r,isContainer:"Container"===n,mimetype:s,contentType:s},this.currentItem}async getResource(t){return new Promise(((e,r)=>{this.fs.readFile(t,"utf8",((t,n)=>t?r(t):e(n)))}))}async getMetadata(t){const e=await this.getResource(t+this.ext);return JSON.parse(e)}async putMetadata(t,e){return new Promise((async(r,n)=>{const s=this.currentItem.mtime=Date.now(),o=this.currentItem.modified=(new Date).toUTCString(),i=e?this.currentItem.size=new Blob([e]).size:4096,a=`{\n        "contentType" : "${this.currentItem.contentType}",\n        "size" : "${i}",\n        "mtime" : "${s}",\n        "modified" : "${o}"\n      }`;return this.fs.writeFile(t+this.ext,a,"utf8",(t=>t?reject(t):r(200)))}))}async putResource(t,e){return t.endsWith("/")?this.makeContainers(t):(this.log("Writing to "+t),e||="",new Promise(((r,n)=>{this.fs.writeFile(t,e,"utf8",(async s=>s?n(s):r(await this.putMetadata(t,e))))})))}async postContainer(t){let e=await this.fs.existsSync(t)?200:201;return t=t.replace(/\/$/,""),new Promise((async function(r){if(await this.fs.existsSync(t))return r(e);this.fs.mkdirp(t,{},(t=>r(t?500:e)))}))}async deleteResource(t){return new Promise((function(e){try{fs.unlink(t,(function(t){e(!t)}))}catch(t){console.log(t),e(!1)}}))}async deleteContainer(t){return new Promise((async function(e){try{await fs.rmdir(t,(function(t){e(!t)}))}catch(t){console.log(t),e(!1)}}))}async getContainer(t){return new Promise((async(e,r)=>{try{this.fs.readdir(t,(async(r,n)=>{if(!r){let r=[];for(let e of n)e.endsWith(this.ext)||r.push(await this.getItemInfo(t+e,{method:"GET"}));return e(r)}e(r)}))}catch(t){e(t)}}))}async dump(t){t||="/","/"!=(t=t.replace(/^\/\//,"/"))&&(t+="/");let e=await this.getContainer(t);if("string"!=typeof e)for(let t of e){let e=await this.getContainer(t);console.log(t,e)}}log(...t){this.DEBUG&&console.log(t)}}})(),n.default})()}));
//# sourceMappingURL=solid-rest-browser.bundle.js.map